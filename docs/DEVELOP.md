## 技術スタック
- Next.js
- TypeScript
- TailWindCSS
- Shadcn/ui
- Drizzle ORM
- Supabase
- Vercel
- Zod
- pnpm
- biome

## 開発ルール
**FSD（Feature Sliced Design）を採用する**

### FSDの採用背景

- AIエージェントによって並列で開発を進められるように機能ベースで分割する
- レビューコストを低減するために依存方向を明確に制限して変更の影響範囲を予想可能にする

#### FSDは、app, pages, widgets, features, entities, sharedの六つのレイヤーから構成されるがNext.jsにおいてはapp, pagesの責務が重複するためpagesを省略する。


### FSDの6つのレイヤー

- **app** : ルーティング定義、グローバルProvider、スタイル初期化など、アプリケーション全体の起動と接着を担う最上位レイヤー。

- **pages** : URLのルートと1対1で対応する画面単位で、widgetやfeatureを配置してページ全体のレイアウトを構成する。

- **widgets** : 複数のentityやfeatureを組み合わせて構成される、自己完結的な大きなUIブロック（ヘッダー、サイドバー、商品一覧パネルなど）。

- **features** : ユーザーが行う具体的な「操作」（ログインする、カートに追加する、検索するなど）のUIとビジネスロジックをまとめるレイヤー。

- **entities** : アプリケーションが扱うビジネス上の「モノ」（ユーザー、商品、注文など）のデータ構造・表示・取得を定義するレイヤーで、操作のロジックは含まない。

- **shared** : ビジネスドメインに一切依存しない、汎用的なUIコンポーネント・ユーティリティ関数・API基盤などの技術的な土台。


### セグメント
#### レイヤーは機能別のスライスから構成され、そのスライスはセグメント（ui, api, model, lib. config）で構成される。

- ui : そのSliceの視覚的な表現（コンポーネント、スタイル）を置く場所。

- api : 外部データソースとの通信（APIリクエスト、DBクエリ、レスポンス変換）を置く場所。

- model : 型定義、状態管理、ビジネスロジック（バリデーション、Server Actionsなど）を置く場所。

- lib : そのSlice内部でのみ使う補助的なヘルパー関数を置く場所。

- config : そのSliceで使う設定値、定数、閾値を置く場所。

### 一言で説明するのであれば、以下の通り。

- **ui :** 見た目
- **api : 外部との**通信
- **model :** ロジックと状態
- **lib :** 内部ヘルパー
- **config :** 設定値



### 原則

#### 基本

- 依存の方向はapp, pages, widgets, features, entities, sharedの上位から下位への一方向のみ
- 同一レイヤー内のスライス間の依存は禁止
- 外部からのアクセスはSliceの`index.ts`（パブリックAPI）のみを通じて行う

#### 構造ルール

- 各レイヤーはビジネスドメインの概念単位でスライスに分割する
- 同一スライスのセグメント間は依存可能
- sharedはスライスを持たず、セグメントはドメインに依存してはならない
- バレルインポートはスライスに置く。スライスを持たないsharedはセグメント単位でバレルを置く

#### 設計慣例

- entitiesが上位レイヤー（features）の操作UIを表示する必要がある場合に、直接依存するのではなくスロット（children/render prop）で注入を受ける
- レイヤーを飛躍するような迂回した依存は可能（依存方向は厳守）

#### FSDの課題と対応

- バレルインポートはサーバーとクライアントが混在するとエラーになる。原則Server Onlyとし、クライアントについてはindex.client.tsによってエクスポートする。
- 型定義については、各スライスで個別に定義するが同一レイヤーのスライス間で共有したい場合はIDだけを持たせて型の参照を避ける